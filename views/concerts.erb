<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>The best concerts in Santa Cruz, California</title>
  <meta name="desciption" content="Listing all of the best concerts happening in downtown Santa Cruz, The Catalyst, Moe's Alley, Crepe Place, Kuumbwa Jazz Center, Rio Theatre, UC Santa Cruz, Crow's Nest, Corner Pocket, Blue Lagoon, Bocci's Cellar and more">
	<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link href='//fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="css/jquery.datepick.css"> 
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/jquery.plugin.js"></script> 
  <script src="js/jquery.datepick.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-61984503-1', 'auto');
    ga('send', 'pageview');

  </script>
</head>
<body>
  <div id="content-wrapper" class="container">
    <div id="header" class="row">
      <div class="col-md-8">
        <a href="/"><h1>Santa Cruz Beat</h1></a>
        <p>All the best concerts happening in Santa Cruz</p>
      </div>
      <div class="calendar-wrapper col-md-4">
        <input id="hidden-date-input">
      </div>
    </div>
    <% if @concert_days.empty? %>
    <h2>Sorry dude, no concerts happening then.</h2>
    <% else %>
    <% @concert_days.each do |day, concerts| %>
    <div class="day-wrapper">
      <h4 class="date"><%= Date.parse(day.to_s).strftime("%A %-m/%d") %></h4>
      <div class="concert-wrapper">
      	<table class="table table-condensed concerts-table">
          <thead>
            <tr>
              <th class="concert"></th>
              <th class="venue"></th>
              <th class="description"></th>
              <th class="time"></th>
              <th class="more"></th>
            </tr>
          </thead>
          <tbody>
          <% concerts.each do |concert| %>
            <tr>
              <td class="title-cell"><%= concert[:title] %></td>
              <td class="venue"><%= concert[:venue] %></td>
              <td class="description"><%= concert.truncated_description %></td>
              <td class="time"><%= concert.local_date_time %></td>
              <td><a href="<%= concert[:link] %>">More info</a></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <% end %>
    <% end %>
  </div>

  <script>
    $(document).ready( function() {
      function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split('=');
          if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
          }
        }
        null;
      }

      console.log(getQueryVariable('from_date'));

      var today = new Date();
      var toDate = new Date().setDate(today.getDate() + 30);

      $('input.form-control').focus();
      $('#hidden-date-input').datepick({
        onClose: function(dates) {
          if (dates[0] == undefined || dates[1] == undefined) {
            return 0;
          }
          var date1 = new Date(dates[0]);
          var date2 = new Date(dates[1]);
          var date1Formatted = date1.getFullYear() + '-' + (date1.getMonth()+1) + '-' + date1.getDate();
          var date2Formatted = date2.getFullYear() + '-' + (date2.getMonth()+1) + '-' + date2.getDate();

          if (date1 == date2) {
            window.location = '/?from_date=' + date1Formatted + '&to_date=' + date1Formatted;
          } else {
            window.location = '/?from_date=' + date1Formatted + '&to_date=' + date2Formatted;
          }
        },
        showTrigger: '<button id="change-date-button" class="btn btn-success change-date" name="daterange">Choose Date Range <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span></button>',
        minDate: new Date(2014, 12-1, 25),
        rangeSelect: true,
        showAnim: 'slideDown',
        showSpeed: 'fast'
      });
    });
  </script>
</body>
</html>